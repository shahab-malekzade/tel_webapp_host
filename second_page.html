<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="format-detection" content="telephone=no"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="MobileOptimized" content="176"/>
  <meta name="HandheldFriendly" content="True"/>
  <meta name="robots" content="noindex,nofollow"/>
  <title>s_page</title>

  <script src="dist/js/tg_web_app.js"></script>

  <link rel="stylesheet" href="dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="asset/css/second_page.css">

  <script>
		function setThemeClass() {
			document.documentElement.className = Telegram.WebApp.colorScheme;
		}

		Telegram.WebApp.onEvent('themeChanged', setThemeClass);
		setThemeClass();
  </script>

</head>

<body>

<section id="first_page">
  <p id="first-p-title" class="first-p-title">
    ฺฉ ุงุดุชุฑุงฺฉ ุงูุชุฎุงุจ ฺฉูุฏ
  </p>
  <h5 id="first-p-desc" class="first-p-desc">
    ุจูุชุฑู ูพุดููุงุฏ ุฑุง ูุชูุงุณุจ ุจุง ูุงุฒ ุฎูุฏ ุงูุชุฎุงุจ ฺฉูุฏ
  </h5>

  <div id="first-p-cards" class="first-p-cards">
    <div class="container" id="scrollContainer">
      <div class="snap-items" id="items">
        <div class="item">
          <div class="card" data-index="0">
            <div class="grid">
              <div class="item-1">
                ุงุดุชุฑุงฺฉ ูพุงู
              </div>
              <div class="item-2">
                !ุฑุงฺฏุงู
              </div>
              <div class="item-3">๐ถ</div>
            </div>
            <hr>
            <p class="features">
              <span class="sticker-features">๐</span>
              <span class="plan-features">
          ฒต ูุงฺฉ ุฏุฑ ุฑูุฒ
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐ฌ</span>
              <span class="plan-features">
          ฺุช ุจุง ูุงุดูุงุณ ุจู ุตูุฑุช ุดุงูุณ
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐ค</span>
              <span class="plan-features">
          ูพุฑููุงู ฺฉุงุฑุจุฑ
          </span>
            </p>
            <div class="stick-bottom">
              <div class="card-button current-sub">
                <a class="purchase-link" disabled>
                  ุงุดุชุฑุงฺฉ ูุนู
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="item">
          <div class="card" data-index="1">
            <div class="grid">
              <div class="item-1">
                ุงุดุชุฑุงฺฉ ุญุฑูู ุง
              </div>
              <div class="item-2">
                <p style="margin: 0;">
                  <span>ฑฐ</span>
                  ุชููุงู / ูุงู
                </p>
              </div>
              <div class="item-3">๐ฅ</div>
            </div>
            <hr>
            <p class="features">
              <span class="sticker-features">๐</span>
              <span class="plan-features">
          ูุงฺฉ ูุงูุญุฏูุฏ
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐ฌ</span>
              <span class="plan-features">
          ฑฐฐ ฺุช ุฌุฏุฏ/ูุงู
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐ค</span>
              <span class="plan-features">
          ฑฐฐ ูพุงู ุฎุตูุต ุฌุฏุฏ/ูุงู
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐</span>
              <span class="plan-features">
          ุจุจูุฏ ฺู ฺฉุณุงู ุดูุง ุฑุง ูุงฺฉ ูฺฉููุฏ
          </span>
            </p>
            <div class="stick-bottom">
              <div class="card-button">
                <a id="professional" class="purchase-link">
                  ุงูุชุฎุงุจ
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="item">
          <div class="card" data-index="2">
            <div class="grid">
              <div class="item-1">
                ุงุดุชุฑุงฺฉ ูพุฑููู
              </div>
              <div class="item-2">
                <p style="margin: 0;">
                  <span>ฑฐ</span>
                  ุชููุงู / ูุงู
                </p>
              </div>
              <div class="item-3">๐ฅ</div>
            </div>
            <hr>
            <p class="features">
              <span class="sticker-features">๐</span>
              <span class="plan-features">
          ูุงฺฉ ูุงูุญุฏูุฏ
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐ฌ</span>
              <span class="plan-features">
          ฑฐฐ ฺุช ุฌุฏุฏ/ูุงู
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐ค</span>
              <span class="plan-features">
          ฑฐฐ ูพุงู ุฎุตูุต ุฌุฏุฏ/ูุงู
          </span>
            </p>
            <p class="features">
              <span class="sticker-features">๐</span>
              <span class="plan-features">
          ุจุจูุฏ ฺู ฺฉุณุงู ุดูุง ุฑุง ูุงฺฉ ูฺฉููุฏ
          </span>
            </p>
            <div class="stick-bottom">
              <div class="card-button">
                <a id="premium" class="purchase-link">
                  ุงูุชุฎุงุจ
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="dot-container" id="dotContainer">
      <div class="pill-bg">
        <span class="dot active" data-index="0"></span>
        <span class="dot" data-index="1"></span>
        <span class="dot" data-index="2"></span>
      </div>
    </div>
  </div>

</section>

<section id="second_page">
  <!--  <a onclick="showFirstPage(currentIndex);">back</a>-->
  <!--  <a onclick="onClickMainButton('https://google.com');">ok</a>-->
  <p id="second-p-title" class="second-p-title">
    <span id="second-p-title-text">ุงุดุชุฑุงฺฉ ูพุฑููู</span>
    <span class="sticker-title">๐๏ธ</span>
  </p>

  <h5 id="second-p-desc" class="second-p-desc">
    ููู ุฏูุง ุงุฒ ฺุช ูุง ุฎุงุฑู ุงูุนุงุฏู ุฑุง ุจุงุฒ ฺฉูุฏุ ุฏุงุณุชุงู ุดูุง ุงุฒ ุงูุฌุง ุดุฑูุน ู ุดูุฏ.
  </h5>

  <div id="second-p-cards" class="plan-cards">
    <div class="plans">
      <div id="interval-1" class="card-2 card-second-page">

        <div id="triangle-1" class="triangle">
          <div style="padding: 5px;"><span>โญ</span></div>
        </div>

        <div class="grid-2">
          <div class="price">
            <p style="font-size: 12px;">
              <span style="font-size: 16px;">นถ</span>
              ุชููุงู / ูุงู
            </p>
          </div>
          <div class="interval-txt">
            ุณุงูุงูู
            <p class="card-desc">
              ุจุฑุง ฺฉ ุณุงู ฺฉุงูู ูพุฑุฏุงุฎุช ฺฉูุฏ
            </p>
          </div>
          <div class="radio-btn">
            <div class="outer-circle">
              <div id="inner-circle-1" class="inner-circle"></div>
            </div>
          </div>
        </div>

        <hr style="margin-bottom: 10px;">

        <p class="features">
          <span class="sticker-features">๐ฐ</span>
          <span class="plan-features-2">
        ุจุง ุฎุฑุฏ ุงุดุชุฑุงฺฉ ุณุงูุงูู ุงุฒ ุชุฎูู ูฺู ุจุฑุฎูุฑุฏุงุฑ ุดูุฏ
      </span>
        </p>
        <p class="features">
          <span class="sticker-features">๐</span>
          <span class="plan-features-2">
        ุงูุชุงุฒุงุช ููุญุตุฑ ุจู ูุฑุฏ ูุดุชุฑฺฉู ุณุงูุงูู ุฑุง ุขุฒุงุฏ ฺฉูุฏ
      </span>
        </p>
        <p class="features">
          <span class="sticker-features">๐ก๏ธ</span>
          <span class="plan-features-2">
        ุณุงู ุฑุง ุจุฏูู ุงูุฒุงุด ููุช ุบุฑ ููุชุธุฑู ุชุฌุฑุจู ฺฉูุฏ
      </span>
        </p>
      </div>

      <div id="interval-2" class="card-2 card-second-page">

        <div class="grid-2">
          <div class="price">
            <p style="font-size: 12px;">
              <span style="font-size: 16px;">ฑฒฐ</span>
              ุชููุงู / ูุงู
            </p>
          </div>
          <div class="interval-txt">
            ูุงูุงูู
            <p class="card-desc">
              ุจู ุตูุฑุช ูุงูุงูู ูพุฑุฏุงุฎุช ฺฉูุฏ
            </p>
          </div>
          <div class="radio-btn">
            <div class="outer-circle">
              <div id="inner-circle-2" class="inner-circle"></div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="discount-card">
    <div class="card-discount discount-card-second-page">
      <button id="discountBtn" class="discount-btn" type="submit">
        ุจุฑุฑุณ
      </button>
      <input type="text" id="discount-input"
             class="discount-input" placeholder="ฺฉุฏ ุชุฎูู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
    </div>
    <div id="result-discount"></div>
  </div>

</section>

<section id="third_page">
  <h2 class="landscape-msg">
    ูุทูุง ุตูุญู ฺฏูุด ุฎูุฏ ุฑุง ุจู ุญุงูุช ุนููุฏ ุจุฑฺฏุฑุฏุงูุฏ
  </h2>
</section>

<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="dist/js/bootstrap.bundle.min.js"></script>
<script type="application/javascript">
	Telegram.WebApp.ready();

	const body = document.body;
	const first_page = document.getElementById("first_page");
	const second_page = document.getElementById("second_page");
	const third_page = document.getElementById("third_page");

	const professionalPlanBtn = document.getElementById('professional');
	const premiumPlanBtn = document.getElementById('premium');

	const interval_1 = document.getElementById('interval-1');
	const interval_2 = document.getElementById('interval-2');
	const triangle_1 = document.getElementById("triangle-1");

	const radio_btn_1 = document.getElementById('inner-circle-1');
	const radio_btn_2 = document.getElementById('inner-circle-2');

	let currentIndex = 0;
	let currentActivePlan = 0;
	const plans_list = ['basic', 'professional', 'premium'];
	let last_page = first_page;
	let last_plan = null;
	let subscription = null;
	let interval = null;

	let cardsListenerExists = false;
	let buttonsListenerExists = false;

	let mainBtnText = 'ุฎุฑุฏ ุงุดุชุฑุงฺฉ ุณุงูุงูู';
	let purchaseURL = 'https://google.com';

	const landscape = window.matchMedia("(orientation: landscape)");
	landscape.addEventListener("change", function (e) {
		if (e.matches) {
			landscapeMode();
		} else {
			if (last_page === first_page) {
				showFirstPage(currentIndex);
			} else {
				showSecondPage(last_plan);
			}
		}
	});

	if (window.matchMedia("(orientation: landscape)").matches) {
		landscapeMode();
	} else {
		if (last_page === first_page) {
			showFirstPage(currentIndex);
		} else {
			showSecondPage(last_plan);
		}
	}

	function showFirstPage(lastIndex = 0) {
		last_page = first_page;
		first_page.style.display = "flex";
		second_page.style.display = "none";
		third_page.style.display = "none";
		Telegram.WebApp.MainButton.hide();
		Telegram.WebApp.BackButton.hide();
		interval_1.classList.remove('selected');
		interval_2.classList.remove('selected');
		radio_btn_1.classList.remove('selected');
		radio_btn_2.classList.remove('selected');
		triangle_1.style.display = "none";
		subscription = null;
		interval = null;

		first_page_function(lastIndex);
	}

	function first_page_function(lastIndex) {
		let container = document.getElementById('scrollContainer');
		let dots = document.querySelectorAll('.dot');

		const items = document.getElementById('items');
		const card = document.querySelector('.item');

		function handlePlanClick(e) {
			// First remove the event listeners
			container.removeEventListener('mousedown', start);
			container.removeEventListener('mouseup', end);
			container.removeEventListener('mousemove', move);
			container.removeEventListener('touchstart', start);
			container.removeEventListener('touchend', end);
			container.removeEventListener('touchmove', move);
			professionalPlanBtn.removeEventListener('click', handlePlanClick);
			premiumPlanBtn.removeEventListener('click', handlePlanClick);

			showSecondPage({'index': currentIndex, 'plan': plans_list[currentIndex]});
		}

		if (!buttonsListenerExists) {
			professionalPlanBtn.addEventListener('click', handlePlanClick);
			premiumPlanBtn.addEventListener('click', handlePlanClick);
			buttonsListenerExists = true;
		}

		let card_width = card.offsetWidth;
		let container_width = container.offsetWidth;
		items.style.transform = `translateX(${0.10 * container_width}px)`;

		if (window.Telegram && window.Telegram.WebApp) {
			document.documentElement.style.setProperty('--tg-viewport-height', `${window.Telegram.WebApp.viewportHeight}px`);
			window.Telegram.WebApp.onEvent('viewportChanged', function (data) {
				if (data && data.isStateStable) {
					document.documentElement.style.setProperty('--tg-viewport-height', `${data.viewportHeight}px`);
				}
			});
		}

		items.style.transform = `translateX(${0.10 * container_width}px)`;

		let isDragging = false;
		let startX = 0;
		let startY = 0;
		let currentTranslate = 0;
		let previousTranslate = 0;
		let animationId = 0;
		let hasMoved = false;
		let directionChecked = false;

		let moveAmount = 0;
		const threshold = 10;
		const slopeThreshold = 0.5;

		let isMouseDown = false;

		currentIndex = lastIndex;
		setPositionByIndex(currentIndex);

		if (!cardsListenerExists) {
			container.addEventListener('mousedown', start);
			container.addEventListener('mouseup', end);
			container.addEventListener('mousemove', move);

			container.addEventListener('touchstart', start);
			container.addEventListener('touchend', end);
			container.addEventListener('touchmove', move);
			cardsListenerExists = true;
		}

		function start(event) {
			isDragging = false;
			hasMoved = false;
			isMouseDown = true;
			startX = getPositionX(event);
			startY = getPositionY(event);
			previousTranslate = currentTranslate;
			cancelAnimationFrame(animationId);
			items.style.transition = 'none';
		}

		function move(event) {
			if (!isMouseDown) return;

			if (!hasMoved) {
				const currentPosX = getPositionX(event);
				const currentPosY = getPositionY(event);
				moveAmount = Math.abs(currentPosX - startX);
				if (moveAmount > threshold) {
					hasMoved = true;
					const xDiff = currentPosX - startX;
					const yDiff = currentPosY - startY;
					const slope = Math.abs(yDiff / xDiff);
					if (slope < slopeThreshold) {
						event.preventDefault();
						body.style.overflow = 'hidden';
						isDragging = true;
						console.log('======> event.preventDefault()')
					}
				}
			}
			if (isDragging) {
				const currentPosX = getPositionX(event);
				const direction = currentPosX - startX;
				if (currentIndex === 0 && direction > 0) {
					currentTranslate = previousTranslate + (currentPosX - startX) / 3;
				} else if (currentIndex === 2 && direction < 0) {
					currentTranslate = previousTranslate + (currentPosX - startX) / 3;
				} else {
					currentTranslate = previousTranslate + (currentPosX - startX);
				}
				setTransform(currentTranslate);
			}
		}

		function end() {
			isDragging = false;
			isMouseDown = false;
			directionChecked = false;

			const movedBy = currentTranslate - previousTranslate;
			items.style.transition = 'transform 0.3s';
			body.style.overflow = 'scroll';

			// If moved a significant amount
			if (movedBy < -5 && currentIndex < 2) {
				currentIndex += 1;
			} else if (movedBy > 5 && currentIndex > 0) {
				currentIndex -= 1;
			}
			setPositionByIndex(currentIndex);
		}

		function getPositionX(event) {
			return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
		}

		function getPositionY(event) {
			return event.type.includes('mouse') ? event.pageY : event.touches[0].clientY;
		}

		function setPositionByIndex(index) {
			dots.forEach(function (dot, i) {
				if (i === currentIndex) {
					dot.classList.add('active');
				} else {
					dot.classList.remove('active');
				}
			});
			if (index === 0) {
				currentTranslate = 0.09 * container_width;
			} else if (index === 1) {
				currentTranslate = (0.09 * container_width) + index * -card_width;
			} else {
				currentTranslate = (0.09 * container_width) + index * -card_width;
			}
			setTransform(currentTranslate);
		}

		function setTransform(value) {
			items.style.transform = `translateX(${value}px)`;
		}
	}

	function showSecondPage(plan) {
		if (plan === null) {
			plan = {'index': 0, 'plan': 'basic'};
		}
		cardsListenerExists = false;
		buttonsListenerExists = false;
		last_page = second_page;
		last_plan = plan;
		subscription = plan;
		first_page.style.display = "none";
		second_page.style.display = "flex";
		third_page.style.display = "none";

		if (plan['plan'] === 'professional') {
			document.getElementById('second-p-title-text').innerHTML = 'ุงุดุชุฑุงฺฉ ุญุฑูู ุง';
		} else if (plan['plan'] === 'premium') {
			document.getElementById('second-p-title-text').innerHTML = 'ุงุดุชุฑุงฺฉ ูพุฑููู';
		}

		selectDefaultInterval();

		function interval_1_func(e) {
			selectDefaultInterval();
		}

		interval_1.addEventListener('click', interval_1_func);

		function interval_2_func(e) {
			interval_1.classList.remove('selected');
			interval_2.classList.add('selected');
			radio_btn_1.classList.remove('selected');
			radio_btn_2.classList.add('selected');
			interval = 'monthly';
			mainBtnText = 'ุฎุฑุฏ ุงุดุชุฑุงฺฉ ูุงูุงูู';
			purchaseURL = 'https://google.com';
			triangle_1.style.display = "none";
		}

		interval_2.addEventListener('click', interval_2_func);

		Telegram.WebApp.MainButton.show();
		Telegram.WebApp.BackButton.show();

		function selectDefaultInterval() {
			interval_1.classList.add('selected');
			interval_2.classList.remove('selected');
			radio_btn_1.classList.add('selected');
			radio_btn_2.classList.remove('selected');
			interval = 'yearly';
			mainBtnText = 'ุฎุฑุฏ ุงุดุชุฑุงฺฉ ุณุงูุงูู';
			purchaseURL = 'https://google.com';
			triangle_1.style.display = "block";
		}

		// Check the discount
		const discountCode = document.getElementById('discount-input');
		const discountBtn = document.getElementById('discountBtn');

		const resultDiscount = document.getElementById('result-discount');
		const handleSubmit = async (e) => {
			e.preventDefault();
			const code = discountCode.value;
			// Send code to server and check if valid
			const isValid = await checkDiscountCode(code);
			if (isValid) {
				// Do the changes in the page here
				discountBtn.removeEventListener('click', handleSubmit);
				resultDiscount.textContent = "ุจุง ููููุช ุงุนูุงู ุดุฏ";
				discountCode.disabled = true;
				discountBtn.disabled = true;
				discountBtn.textContent = 'ุญูู';
			} else {
				resultDiscount.textContent = "ฺฉุฏ ุชุฎูู ูุนุชุจุฑ ูู ุจุงุดุฏ";
			}

		};
		discountBtn.addEventListener('click', handleSubmit);

		async function checkDiscountCode(code) {
			// Fake request to server
			return new Promise(resolve => {
				setTimeout(() => {
					resolve(code === 'DISCOUNT10');
				}, 1000);
			});
		}
	}

	function onClickMainButton(url) {
		currentActivePlan = subscription['index'];
		console.log(`The chosen plan is : ${subscription['index']} - ${subscription['plan']} and interval is : ${interval}`);
		Telegram.WebApp.openLink(url, {try_instant_view: true});
	}

	Telegram.WebApp.MainButton
			.setText(mainBtnText)
			.onClick(function () {
				onClickMainButton(purchaseURL);
			});

	Telegram.WebApp.BackButton
			.onClick(function () {
				showFirstPage(currentIndex);
			});

	function landscapeMode() {
		first_page.style.display = "none";
		second_page.style.display = "none";
		third_page.style.display = "block";
	}

</script>
</body>
</html>